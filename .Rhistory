source('~/minos/US_knn.R')
install.packages("Rcpp")
install.packages("Rcpp")
source('~/minos/US_knn.R')
source('~/minos/US_knn.R')
source('~/minos/US_knn.R')
source('~/minos/US_knn.R')
source('~/minos/US_knn.R')
knn_set
len(knn_set)
length(knn_set)
length(knn_set$depression_change)
table(knn_set$depression_change)
sum(table(knn_set$depression_change))
summary(data)
summary(knn_set)
marginplot(data[, c("SF.12", "age")])
marginplot(hotdeck_set[, c("SF.12", "age")])
source('~/minos/minos/data_generation/US_hotdecking.R')
print(summary(data[,c("SF.12", "depression_change", "change")]))
hotdeck_set <- hotdeck(
data,
variable = c(columns),
ord_var = c("age")
)
print(summary(hotdeck_set[,c("SF.12", "depression_change", "change")]))
print(summary(data[,c("SF.12", "depression_change", "change")]))
hotdeck_set <- hotdeck(
data,
variable = c(columns),
ord_var = c("age")
)
print(summary(hotdeck_set[,c("SF.12", "depression_change", "change")]))
data <- read.csv(file_name)
missing <- c("-1", "-2", "-7", "-8", "-9",
-1, -2, -7, -8,- 9,
-1., -2., -7., -8., -9.)
columns <- c("SF.12", "job_sec","education_state", "sex",
"depression_change", "depression", "labour_state", "job_sec",
"tumble_dryer", "dishwasher", "microwave", "region",#"heating",
"job_duration_m", "job_duration_y", "job_industry", "ethnicity",
"job_occupation", "birth_month", "academic_year" )
for(co in columns){
i <- which(data[,co]%in%missing)
data[,co] <- replace(data[,co], i, NA)
}
print(summary(data[,c("SF.12", "depression_change", "change")]))
hotdeck_set <- hotdeck(
data,
variable = c(columns),
ord_var = c("age")
)
print(summary(hotdeck_set[,c("SF.12", "depression_change", "change")]))
hotdeck_set <- hotdeck(
data,
variable = c(columns),
ord_var = c("age")
)
print(summary(hotdeck_set[,c("SF.12", "depression_change", "change")]))
print(summary(hotdeck_set[,c("SF.12", "depression_change", "depression")]))
source('~/minos/US_MICE.R')
source('~/minos/US_MICE.R')
source('~/minos/US_MICE.R')
install.packages("mice")
source('~/minos/US_MICE.R')
source('~/minos/US_MICE.R')
source('~/minos/US_MICE.R')
source('~/minos/US_MICE.R')
mice_set
source('~/minos/US_MICE.R')
mice_set
source('~/minos/US_MICE.R')
mice(data = data[,c("SF.12", "depression_change", "depression")],
m = 5, method = "norm.predict", maxit = 50, seed = 500,
remove.collinear=FALSE)
corr(data[,c("SF.12", "depression_change", "depression")])
cov(data[,c("SF.12", "depression_change", "depression")])
source('~/minos/US_MICE.R')
warnings()
mice_set
mice_set$blocks
mice_set$formulas
mice_set$data
warnings()
complete(mice_set)
table(data$SF.12)
table(data$depression_change)
table(data$depression)
mice(data = data[,c("SF.12", "depression_change", "depression")], maxit = 5)
asd <- mice(data = data[,c("SF.12", "depression_change", "depression")], maxit = 5)
qa
a
complete(asd)
complete(asd)$depression
length(complete(asd)$depression) - sum(table(complete(asd)$depression))
length(complete(asd)$depression-change) - sum(table(complete(asd)$depression_change))
length(complete(asd)$depression_change) - sum(table(complete(asd)$depression_change))
length(complete(asd)$SF.12) - sum(table(complete(asd)$SF.12))
source('~/minos/minos/data_generation/US_hotdecking.R')
source('~/minos/minos/data_generation/US_hotdecking.R')
matrixplot(data, sortby=c("SF.12"), cex.axis=0.7)
matrixplot(data, sortby=c("SF.12"), cex.axis=0.6, oma = c(6, 1, 1, 1))
matrixplot(data, sortby=c("SF.12"), cex.axis=0.5, oma = c(7, 1, 1, 1))
?pbox
pbox(data[,c("ethnicity", "SF.12")])
pbox(data[,c("SF.12", "ethnicity")])
pbox(data[,c("SF.12")])
pbox(data$SF.12
)
pbox(data)
pbox(data, cex.axis = 0.6)
pbox(data[,c("depression", "depression_state", "SF.12")], cex.axis = 0.6)
pbox(data[,c("depression", "depression_state", "SF-12")], cex.axis = 0.6)
pbox(data[,c("depression", "depression_change", "SF.12")], cex.axis = 0.6)
histogram(~age|R, data)
library(mice)
histogram(~age|R, data)
library(lattice)
histogram(~age|R, data)
histogram(~age|is.na(data), data)
histogram(~SF.12|is.na(data), data)
is.na.POSIXlt()
is.na(data$SF.12)
R<- is.na(data$SF.12)
histogram(~SF.12|R, data)
R
histogram(~SF.12|R, data$SF.12)
histogram(~SF.12|R, data)
data
data$SF.12
histogram(SF.12|R, data)
histogram(1~SF.12|R, data)
histograme(data$SF.12)
histogram(data$SF.12)
histogram(~SF.12|R)
histogram(~SF.12|R, data)
R
histogram(~age|R, data)
histogram(~depression_change|R, data)
histogram(~factor(depression)|R, data)
histogram(~factor(depression_change)|R, data)
histogram(~factor(ethnicity)|R, data)
histogram(~factor(labour_state)|R, data)
histogram(~birth_year|R, data)
histogram(~factor(education_state)|R, data)
source('~/minos/housing_mice.R')
getcwd()
getwd()`
)
)
)
))
)))))))))))))))))))))))))
1+1
1=
1
1
1
densityplot(mice_set)
require(lattice)
densityplot(mice_set)
densityplot(data2$heating)
source("utils.R") # for data formatting functions and other useful globals.
require(VIM) # for missingness visualisation.
require(mice) # for mice multiple imputation.
require(lattice) # for mice imputation functions.
require(ordinal) # for clm models.
require(tidyr) # for data frame formatting.
require(viridis) # for python's nice colour palettes
# load data from 2011 and format it via utils.R functions.
data_source<- "data/corrected_US/"
years <- c("2011")
file_names <- get_US_file_names(data_source, years)
data <- get_US_data(file_names)
data <- format_US_housing_data(data)
n_heating_missing <- nrow(data) - sum(complete.cases(data[,c("heating")]))
n_five_missing <- nrow(data) - sum(complete.cases(data[,c("fridge_freezer", "washing_machine", "tumble_dryer", "dishwasher", "microwave")]))
n_six_missing <- nrow(data) - sum(complete.cases(data[,c("fridge_freezer", "washing_machine", "tumble_dryer", "dishwasher", "microwave", "heating")]))
household_vars = c("fridge_freezer",
"washing_machine",
"tumble_dryer",
"dishwasher",
"microwave",
"heating")
a <- aggr(data, cex.axis=.5, oma=c(5,2,2,5),numbers=T, cex.numbers=0.5) # cex and oma adjustments so all labels show up.
b <- aggr(data[, household_vars], numbers=T, cex.axis=.5, oma=c(5,2,2,5))
is_missing_heating <- is.na(data$heating)
is_missing_five <- is.na(data$fridge_freezer)
histogram(~age|is_missing_heating, data)
histogram(~age|is_missing_five, data)
histogram(~SF.12|is_missing_heating, data)
histogram(~SF.12|is_missing_five, data)
# needs better scaling for low % missing data
# scaling works with ylim change but ticks needs relabelling.
#spineMiss(data[, c("job_sec", "heating")], col = c(blue, orange), ylim=c(0, 0.2))
#spineMiss(data[, c("job_sec", "fridge_freezer")], col = c(blue, orange), )
missing_barchart <- function(data, v1, v2){
print(v1)
print(v2)
missing_table <- table(data[,v1], is.na(data[,v2]))
# not guaranteed to be on these rows. needs forcing to correct labels somehow.
missing_percent <- missing_table[,2]/(missing_table[,1]+missing_table[,2])
barchart(missing_percent, ylab = v1)
}
missing_barchart(data, "ethnicity", "heating")
missing_barchart(data, "ethnicity", "heating")
missing_barchart(data, "depression_change", "heating")
missing_barchart(data, "education_state", "heating")
missing_barchart(data, "labour_state", "heating")
missing_barchart(data, "sex", "heating")
missing_barchart(data, "job_sec", "heating")
imp_columns <- c("five_household", "heating", "labour_state", "education_state",
"sex", "job_sec", "ethnicity", "age", "SF.12")
house_mice <- mice(data = data[,imp_columns],
m = 20, maxit = 20, seed = 500,
remove.collinear=T)
print(summary(complete(house_mice)[,c("five_household","heating")]))
plot(house_mice)
data2<- complete(house_mice)
data2 <- tidyr::drop_na(data2)
# format final housing composite. If they have no appliances assign 0.
# any up to 5 assign 1.
# all assign 2.
data2$housing <- rowSums(data2[, c("five_household", "heating")])
data2[which(data2$housing <= 3), "housing"] <- 0
data2[which(data2$housing <= 4 & data2$housing > 3), "housing"] <- 1
data2[which(data2$housing <= 5), "housing"] <- 2
data2$housing <- factor(data2$housing, levels = c(0,1,2))
n <- nrow(data2)
set.seed(88)
Inx <- sample(n, 0.8*n)
train<-data2[Inx,]
test<-data2[-Inx,]
y <- test$housing
test <- subset(test, select= - housing)
formula <- "housing ~ factor(sex) +
age +
SF.12 +
factor(labour_state) +
factor(job_sec)"
housing.clmm <- clm(housing ~ factor(sex) +
age +
SF.12 +
factor(labour_state) +
factor(job_sec) +
factor(ethnicity),
data= train[complete.cases(train),],
link = "logit",
threshold = "flexible",
Hess=T)
data2<- complete(house_mice)
data2 <- tidyr::drop_na(data2)
# format final housing composite. If they have no appliances assign 0.
# any up to 5 assign 1.
# all assign 2.
data2$housing <- rowSums(data2[, c("five_household", "heating")])
data2[which(data2$housing <= 3), "housing"] <- 0
data2[which(data2$housing <= 4 & data2$housing > 3), "housing"] <- 1
data2[which(data2$housing <= 5), "housing"] <- 2
data2$housing <- factor(data2$housing, levels = c(0,1,2))
n <- nrow(data2)
set.seed(88)
Inx <- sample(n, 0.8*n)
train<-data2[Inx,]
test<-data2[-Inx,]
y <- test$housing
test <- subset(test, select= - housing)
formula <- "housing ~ factor(sex) +
age +
SF.12 +
factor(labour_state) +
factor(job_sec)"
housing.clmm <- clm(housing ~ factor(sex) +
age +
SF.12 +
factor(labour_state) +
factor(job_sec) +
factor(ethnicity),
data= train[complete.cases(train),],
link = "logit",
threshold = "flexible",
Hess=T)
data2$housing
data2[which(data2$housing <= 3), "housing"] <- 0
data2<- complete(house_mice)
data2 <- tidyr::drop_na(data2)
# format final housing composite. If they have no appliances assign 0.
# any up to 5 assign 1.
# all assign 2.
data2$housing <- rowSums(data2[, c("five_household", "heating")])
data2$housing
data2[which(data2$housing <= 3), "housing"] <- 0
data2
data2$housing
data2[which(data2$housing <= 3), "housing"] <- 0
data2[which(data2$housing <= 4 & data2$housing > 3), "housing"] <- 1
data2[which(data2$housing >= 5), "housing"] <- 2
data2$housing
data2<- complete(house_mice)
data2 <- tidyr::drop_na(data2)
# format final housing composite. If they have no appliances assign 0.
# any up to 5 assign 1.
# all assign 2.
data2$housing <- rowSums(data2[, c("five_household", "heating")])
data2[which(data2$housing <= 3), "housing"] <- 0
data2[which(data2$housing <= 4 & data2$housing > 3), "housing"] <- 1
data2[which(data2$housing >= 5), "housing"] <- 2
data2$housing <- factor(data2$housing, levels = c(0,1,2))
n <- nrow(data2)
set.seed(88)
Inx <- sample(n, 0.8*n)
train<-data2[Inx,]
test<-data2[-Inx,]
y <- test$housing
test <- subset(test, select= - housing)
formula <- "housing ~ factor(sex) +
age +
SF.12 +
factor(labour_state) +
factor(job_sec)"
housing.clmm <- clm(housing ~ factor(sex) +
age +
SF.12 +
factor(labour_state) +
factor(job_sec) +
factor(ethnicity),
data= train[complete.cases(train),],
link = "logit",
threshold = "flexible",
Hess=T)
print(summary(housing.clmm))
prs<- 1 - logLik(housing.clmm)/logLik(clm2(housing ~ 1,data= train))
print(prs)
